(()=>{"use strict";var t=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",n)},e=function(t){var e;t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n),t.querySelector(".popup__form")&&"edit-profile"!==(null===(e=t.querySelector(".popup__form"))||void 0===e?void 0:e.name)&&t.querySelector(".popup__form").reset()},n=function(t){if("Escape"===t.key){var n=document.querySelector(".popup_is-opened");n&&e(n)}},r=function(t,n){if(t.target.classList.contains("popup_is-opened")||t.target.classList.contains("popup__close")){var r=t.target.closest(".popup")||t.target;e(r),n()}},o={baseUrl:"https://nomoreparties.co/v1/higher-front-back-dev",headers:{authorization:"378d653b-1a2b-486f-80ad-74276afb7abc","Content-Type":"application/json"}},c=(document.querySelector(".profile__title"),document.querySelector(".profile__description"),document.querySelector("#card-template").content.querySelector(".places__item")),a=(document.querySelector(".popup_type_delete_card"),function(t,e){var n=t.target.closest(".card").querySelector(".card__like-count");t.target.classList.contains("card__like-button_is-active")?(function(t){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:o.headers,body:JSON.stringify({cardId:t})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}(e).then(function(t){n.textContent=t.likes.length}),t.target.classList.remove("card__like-button_is-active")):(function(t){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:o.headers,body:JSON.stringify({cardId:t})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}(e).then(function(t){n.textContent=t.likes.length}),t.target.classList.add("card__like-button_is-active"))}),u=function(t,e,n){var r=n.onDelete,o=n.onImageClick,u=c.cloneNode(!0);u.setAttribute("data-card-id",t._id);var i=u.querySelector(".card__delete-button"),l=u.querySelector(".card__like-button"),s=u.querySelector(".card__image"),d=u.querySelector(".card__like-count");return t.likes.some(function(t){return t._id===e})?l.classList.add("card__like-button_is-active"):l.classList.remove("card__like-button_is-active"),t.owner._id!==e&&(i.hidden=!0),s.src=t.link,s.alt=t.name,d.textContent=t.likes.length,u.querySelector(".card__title").textContent=t.name,i.addEventListener("click",function(){return r(t._id)}),s.addEventListener("click",o),l.addEventListener("click",function(e){return a(e,t._id)}),u},i="Сохранение...";function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var s,d=document.querySelector(".places__list"),p=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),_=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_image"),v=document.querySelector(".popup_type_edit-avatar"),h=document.querySelector(".popup_type_delete_card"),S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),g=document.querySelector(".popup__input_type_name"),q=document.querySelector(".profile__image"),k=document.querySelector(".popup__input_type_description"),C=document.querySelector(".popup__input_type_card-name"),L=document.querySelector('.popup__form[name="edit-profile"]'),E=document.querySelector('.popup__form[name="new-place"]'),x=E.querySelector(".popup__input_type_url"),j=document.querySelector('.popup__form[name="edit-avatar"]'),A=j.querySelector(".popup__input_type_url"),P=E.querySelector(".popup__button"),I=L.querySelector(".popup__button"),D=document.querySelector(".popup_type_delete_card");D.querySelector(".popup__button").addEventListener("click",function(t){t.preventDefault();var n,r=D.querySelector(".popup__button"),c=r.textContent;r.textContent="Удаление...",s&&(n=s,fetch("".concat(o.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:o.headers,body:JSON.stringify({cardId:n})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then(function(){var t=document.querySelector('[data-card-id="'.concat(s,'"]'));t&&t.remove(),e(D)}).finally(function(){s=null,r.textContent=c})}),h.addEventListener("click",function(t){r(t,function(){})});var O=function(e){s=e,t(D)},U=function(e){t(y);var n=document.querySelector(".popup__image"),r=document.querySelector(".popup__caption");n.src=e.target.src,n.alt=e.target.alt,r.textContent=e.target.alt};q.addEventListener("click",function(){t(v)}),v.addEventListener("submit",function(t){t.preventDefault();var n=A.value.trim(),r=t.target.querySelector(".popup__button"),c=r.textContent;r.textContent=i,function(t){return fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})}(n).then(function(t){q.style.backgroundImage="url(".concat(t.avatar,")")}).then(function(){e(v),V(j)}).catch(function(t){console.error("Ошибка обновления аватара:",t)}).finally(function(){r.textContent=c})}),_.addEventListener("submit",function(t){t.preventDefault();var e,n,c=t.target.querySelector(".popup__button"),a=c.textContent;c.textContent=i,(e=g.value,n=k.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:e,about:n})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then(function(){r(t,function(){return V(L)})}).catch(function(t){console.error("Ошибка обновления профиля:",t)}).finally(function(){c.textContent=a})}),y.addEventListener("click",function(t){return r(t,function(){})}),m.addEventListener("click",function(t){r(t,function(){return V(E)})}),p.addEventListener("click",function(){t(_),g.value=S.textContent,k.value=b.textContent,N([g,k],I)}),v.addEventListener("click",function(t){r(t,function(){return V(j)})}),_.addEventListener("click",function(t){r(t,function(){return V(L)})}),f.addEventListener("click",function(){t(m)}),L.addEventListener("submit",function(t){t.preventDefault(),S.textContent=g.value,b.textContent=k.value,e(_)}),E.addEventListener("input",function(){var t=E.checkValidity();P.disabled=!t,P.classList.toggle("popup__button_disabled",!t)}),E.addEventListener("submit",function(t){t.preventDefault();var n,r,c=t.target.querySelector(".popup__button"),a=c.textContent;c.textContent="Создание...",(n=C.value,r=x.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:n,link:r})}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then(function(t){var n=u(t,t.owner._id,{onDelete:O,onImageClick:U});d.prepend(n),E.reset(),e(m),V(E)}).catch(function(t){console.error("Ошибка добавления карточки:",t)}).finally(function(){c.textContent=a})}),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".popup").forEach(function(t){t.classList.add("popup_is-animated")})}),Promise.all([fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then(function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})]).then(function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(e,n)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];S.textContent=o.name,b.textContent=o.about,q.style.backgroundImage="url(".concat(o.avatar,")"),c.forEach(function(t){d.append(u(t,o._id,{onDelete:O,onImageClick:U}))})});var w=function(t){var e=t.inputSelector,n=t.submitButtonSelector,r=t.inactiveButtonClass,o=t.inputErrorClass,c=function(t){return Array.from(t.querySelectorAll(e))},a=function(t,e){!function(t){return t.some(function(t){return!t.validity.valid})}(t)?(e.disabled=!1,e.classList.remove(r)):(e.disabled=!0,e.classList.add(r))},u=function(t){return document.querySelector(".".concat(t,"-error"))},i=function(t){t.classList.remove(o);var e=u(t.id);t.setCustomValidity(""),e.textContent=""},l=function(t){return t.validity.valid?i(t):function(t){t.classList.add(o),u(t.id).textContent=t.validationMessage}(t)};return{clearValidation:function(t){var e=t.querySelector(n),r=c(t);r.forEach(i),a(r,e)},enableValidation:function(){Array.from(document.forms).forEach(function(t){!function(t){var e=c(t),r=t.querySelector(n);a(e,r),e.forEach(function(t){t.addEventListener("input",function(t){!function(t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity("")}(t.target),l(t.target),a(e,r)})})}(t)})},toggleButtonState:a,checkInputValidity:l}}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),V=w.clearValidation,T=w.enableValidation,N=w.toggleButtonState;T()})();